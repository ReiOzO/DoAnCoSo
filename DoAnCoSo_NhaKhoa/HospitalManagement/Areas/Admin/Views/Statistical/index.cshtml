@{
    ViewBag.Title = "Index";
    Layout = "~/Areas/Admin/Views/Shared/_LayoutAdmin.cshtml";
    var currentYear = DateTime.Now.Year;
}

@section CSS{

    <!--Morris.js [ OPTIONAL ]-->
    <link href="/Areas/Admin/Content/plugins/morris-js/morris.min.css" rel="stylesheet">
}

<div class="row">
    <div class="col-md-7">
        <!-- Area Chart -->
        <!---------------------------------->
        <div class="panel">
            <div class="panel-heading">
                <div class="panel-control">
                    <input type="number" placeholder="Textbox" value="@currentYear" id="year" class="form-control">
                </div>
                <h3 class="panel-title">Số lượng bệnh nhân thăm khám</h3>
            </div>
            <div class="pad-all">
                <div id="demo-morris-area-legend" class="text-center"></div>
                <div id="demo-morris-area" style="height:250px"></div>
            </div>
        </div>
        <!---------------------------------->
    </div>
    <div class="col-lg-5">
        <div class="row">
            <div class="col-sm-6 col-lg-6">
                <div class="panel panel-info panel-colorful">
                    <div class="pad-all">
                        <p class="text-lg text-semibold"><i class="demo-pli-add-user icon-fw"></i>Bệnh nhân</p>
                        <p class="mar-no">
                            <span class="pull-right text-bold">@ViewBag.PatientTodayCount</span> Hôm nay
                        </p>
                        <p class="mar-no">
                            <span class="pull-right text-bold">@ViewBag.PatientMonthCount</span> Tháng này
                        </p>
                    </div>
                    <div class="pad-top text-center">
                        <div id="demo-sparkline-area" class="sparklines-full-content"></div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-lg-6">
                <div class="panel panel-warning panel-colorful">
                    <div class="pad-all">
                        <p class="text-lg text-semibold"><i class="demo-pli-calendar-4 icon-fw"></i> Lịch đặt</p>
                        <p class="mar-no">
                            <span class="pull-right text-bold">@ViewBag.ScheduleTodayCount</span> Hôm nay
                        </p>
                        <p class="mar-no">
                            <span class="pull-right text-bold">@ViewBag.ScheduleMonthCount</span> Tháng này
                        </p>
                    </div>
                    <div class="text-center">
                        <div id="demo-sparkline-bar" class="box-inline"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts{
    <script src="/Areas/Admin/Content/plugins/flot-charts/jquery.flot.min.js"></script>
    <script src="/Areas/Admin/Content/plugins/flot-charts/jquery.flot.resize.min.js"></script>
    <script src="/Areas/Admin/Content/plugins/flot-charts/jquery.flot.tooltip.min.js"></script>

    <!--Sparkline [ OPTIONAL ]-->
    <script src="/Areas/Admin/Content/plugins/sparkline/jquery.sparkline.min.js"></script>

    <!--Specify page [ SAMPLE ]-->
    <script src="/Areas/Admin/Content/js/demo/dashboard.js"></script>

    <!--Morris.js [ OPTIONAL ]-->
    <script src="/Areas/Admin/Content/plugins/morris-js/morris.min.js"></script>
    <script src="/Areas/Admin/Content/plugins/morris-js/raphael-js/raphael.min.js"></script>
    <script src="~/Areas/Admin/Content/js/live/chart.statistical.js"></script>

    <script>

        // ================== START - Chart ==================

        const baseUrl = `/Admin/Statistical`;

        function getCharData(year) {
            notify.loading();
            ajax.get(`${baseUrl}/GetRegByYear`,
                {
                    year: year
                },
                (response) => {
                    if (response.status) {
                        const obj = response.data;
                        chart.initChart(obj,'demo-morris-area', 'demo-morris-area-legend');
                    } else {
                        notify.push(response.mess, notify.EType.DANGER);
                    }
                    notify.done();
                },
                (jqXhr, textStatus) => {
                    const mess = `Request failed: ${textStatus}`;
                    notify.push(mess, notify.EType.DANGER);
                    notify.done();
                }
            );
        }

        $("#year").change(function () {
            $("#demo-morris-area").empty();
            $('#demo-morris-area-legend').empty();
            const year = $(this).val();
            getCharData(year);
        });

        getCharData(@currentYear);

        function getCharDataDoughnut(categoryId) {
            notify.loading();
            ajax.get(`${baseUrl}/GetItemByCategory`,
                {
                    categoryId: categoryId
                },
                (response) => {
                    if (response.status) {
                        const obj = response.data;
                        chart.initChartDoughnut(obj, 'demo-morris-donut');
                    } else {
                        notify.push(response.mess, notify.EType.DANGER);
                    }
                    notify.done();
                },
                (jqXhr, textStatus) => {
                    const mess = `Request failed: ${textStatus}`;
                    notify.push(mess, notify.EType.DANGER);
                    notify.done();
                }
            );
        }
        $("#CategoryId").change(function () {
            $("#demo-morris-donut").empty();
            const categoryId = $(this).val();
            getCharDataDoughnut(categoryId);
        });

        getCharDataDoughnut($("#CategoryId").val());
        // ================== END - Chart ==================

        const basePatientUrl = "/admin/Patient";

        //Edit
        function openEditing(id) {
            notify.loading();
            window.location.href = `${basePatientUrl}/update?id=${id}`;
        }
        //Edit
        function openRecord(id) {
            notify.loading();
            window.location.href = `/admin/record?patientId=${id}`;
        }
    </script>
    <script>
        !function (d, s, id) { var js, fjs = d.getElementsByTagName(s)[0]; if (!d.getElementById(id)) { js = d.createElement(s); js.id = id; js.src = 'https://weatherwidget.io/js/widget.min.js'; fjs.parentNode.insertBefore(js, fjs); } }(document, 'script', 'weatherwidget-io-js');
    </script>

}